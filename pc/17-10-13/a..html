<!doctype html>
<html lang="en" style="margin: 0; padding: 0; border: 0; width: 100%; height: 100%;">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body style="margin: 0; padding: 0; border: 0; width: 100%; height: 100%;" >
<canvas style="display: block; width: 1440px; height: 523px;" width="1440" height="523" id="a"></canvas>
<script>
    var a = document.getElementById('a');
    var b = a.getContext('2d');
    var c = a.getContext('2d');
    function p(i, s, t) {
        this.x = i,
                this.y = s,
                this.z = t,
                this.v = 0
    }
    function gL() {
        for (i = 1; s - 1 > i; i++)
            for (k = 1; s - 1 > k; k++)
                q[i * s + k].v += (q[(i + 1) * s + k].y + q[(i - 1) * s + k].y + q[i * s + k + 1].y + q[i * s + k - 1].y - 4 * q[i * s + k].y) * d,
                        q[i * s + k].v = .995 * q[i * s + k].v;
        for (i = 1; s - 1 > i; i++)
            for (k = 1; s - 1 > k; k++)
                q[i * s + k].y += md ? -20 / (1 + (i + fx) * (i + fx) / 10 + (k + fz) * (k + fz) / 10) : 0;
        for (i = 0; s * s > i; i++)
            q[i].y += q[i].v / 2 * d;
        for (c.clearRect(0, 0, w, h),
                     cx = m.cos(xR),
                     cy = m.cos(yR),
                     sx = m.sin(xR),
                     sy = m.sin(yR),
                     px = A * sy * cx,
                     py = A * sx,
                     pz = A * cx * cy,
                     i = s * s - 1; i >= 0; i--) {
            var t = q[i].x * cy - q[i].z * sy
                    , y = -q[i].x * sx * sy + q[i].y * cx - sx * cy * q[i].z
                    , x = q[i].x * sy * cx + q[i].y * sx + q[i].z * cx * cy;
            tf[i] = [t, y, x]
        }
        tf.push([fx, 0, fz]);
        for (var f = s * s - 1; f >= 0; f--) {
            var o = (tf[f][2] + A) / A;
            if (o > 0) {
                var r = tf[f][0] / o + a.width / 2
                        , e = tf[f][1] / o + a.height / 2;
                c.fillRect(r - 6 / o, e - 6 / o, 3 / o, 3 / o)
            }
        }
        xR += n,
                n *= .8,
                yR += C,
                C *= .8
    }
    function tk() {
        gL(),
                rq(tk)
    }
    function rC(i) {
        x = ~~i.pageX - w / 2,
                y = ~~i.pageY - h / 2,
                tx = x * cy + sy * (A * cx - y * sx),
                ty = y * cx + py,
                tz = -x * sy + cy * (A * cx - y * sx),
                l = -py / ty,
                fx = (px + l * tx) / 10 - t,
                fz = (pz + l * tz) / 10 - t
    }
    var xR = .4, yR = 0, w = a.width, h = a.height, m = Math, q = [], tf = [], rq = requestAnimationFrame, s = 128, t = s / 2, d = 1, A = 1500, md, fx = 0, fz = 0, g = .003, n = 0, C = 0;
    for (b.onkeydown = function(i) {
        var s = i.keyCode;
        80 == s && (d = 1 - d),
        87 == s && (n += g),
        83 == s && (n -= g),
        65 == s && (C += g),
        68 == s && (C -= g)
    }
                 ,
                 i = -t; t > i; i++)
        for (k = -t; t > k; k++)
            q.push(new p(10 * i,0,10 * k));
    a.onmousedown = function(i) {
        md = !0,
                rC(i)
    }
            ,
            a.onmousemove = function(i) {
                rC(i)
            }
            ,
            a.onmouseup = function() {
                md = !1
            }
            ,
            rq(tk);

</script>
</body>
</html>